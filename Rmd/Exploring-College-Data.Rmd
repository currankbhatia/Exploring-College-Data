---
title: "Exploring-College-Data"
author: "Curran Bhatia"
date: "11/12/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache= TRUE)

```

We will start by importing the data from The Wall Street Journal and Payscale regarding Salaries based on college.

```{r message=FALSE, warning=FALSE}
library(tidyverse)

```

```{r message = FALSE}

salaries = read_csv("../data/college-salaries/salaries-by-college-type.csv")
salaries

#x = names


defactorize = function(dfcol) {
  
  x = dfcol
  y = sub('\\$','',x)
  xy = as.numeric(sub('\\,','',as.character(y)))
  #dfcol = xy
  return (xy)
  
}

for (i in 3:length(names(salaries))) {
  salaries[[names(salaries)[i]]] = defactorize(salaries[[names(salaries)[i]]])
}



salaries

# Received help from: https://stat.ethz.ch/pipermail/r-help/2010-May/237909.html in order to change the characters into numbers

```



Now I want to plot the average salary based on type of school, Party, Engineering, Liberal Arts, State and Ivy. We don't necessarily need to tidy the data anymore than when we read it in, because it seems like all the columns have variables and rows have observations. Now I want to get the average salary per school type. 

```{r}

create_mean_df = function(var1) {
  
  df = tibble(salaries$`School Name`, salaries$`School Type`, var1)

  colnames(df) = c("name", "types", "median_salary")
#mid_career_df

  types_colleges = unique(df$types)
  
  
  avg_midcareer = vector(mode="numeric", length= 5)
  i = 1
  for (x in types_colleges) {
    
    sal_filter = filter(df, types == x)
    avg_midcareer[i] = mean(sal_filter$median_salary, na.rm = TRUE)
    
    i = i + 1
  }
  
  return (tibble(types_colleges, avg_midcareer))
  
}


midcareer_type_df = create_mean_df(salaries$`Mid-Career Median Salary`)

ggplot(midcareer_type_df, aes(types_colleges, avg_midcareer, fill = types_colleges)) + geom_col() + ggtitle(" Mean Avg-Mid-Career")


```


```{r}

midcareer75th_type_df = create_mean_df(salaries$`Mid-Career 75th Percentile Salary`)

ggplot(midcareer75th_type_df, aes(types_colleges, avg_midcareer, fill = types_colleges)) + geom_col() + ggtitle("75th Percentile Mean Avg-Mid-Career")


```

```{r}

startingsalary_type_df = create_mean_df(salaries$`Starting Median Salary`)

ggplot(startingsalary_type_df, aes(types_colleges, avg_midcareer, fill = types_colleges)) + geom_col() + ggtitle("Starting Median Salary Avg")



```

### College List with Addresses

```{r}
library(stringr)

salaries

colnames(salaries)


address = c(nrow = nrow(salaries))
address[1:nrow(salaries)] = "None"



colleges <- add_column(salaries, Address = address)
colleges

colnames(colleges)

max_colleges = read.csv("../data/Accreditation_04_2017.csv")

max2 = lapply(max_colleges, as.character)


for (i in 1:nrow(colleges)) {

  name = colleges[i,"School Name"]
  
  
  
  #name = name %>% gsub("\\(" , " ", .) %>% gsub("\\)" , " ", .)
  
  name = name %>% gsub("\\((.*)\\)", "", .) %>% gsub("  ", " ", .) 
  
  if (str_sub(name, nchar(name), nchar(name)) == " " )
    name = str_sub(name, 1,  nchar(name)-1)
  
  #if (nchar(name) > 25)
    #name = substr(name, 1, 25)
  
  vals = grep(name, max2$Institution_Name)
  
  num = vals[1]

  
  colleges[i,"Address"] = paste(max2$Institution_Address[num],
                                max2$Institution_City[num],
                                max2$Institution_State[num])
}


select(colleges, `School Name`,Address)



set_address = function ( name, address) {
  
  vals2 = grep(name, colleges$`School Name`)
  num = vals2[1]
  colleges[num,"Address"] <- address
  
}
```


Individual clean-up 

```{r}
set_address("Polytechnic University of New York, Brooklyn", "6 MetroTech Center, Brooklyn, NY 11201")

set_address("South Dakota School of Mines & Technology", "501 E St Joseph St, Rapid City, SD 57701")



```

Coordinates

```{r cache = TRUE}

library(ggmap)

long = c(nrow = nrow(salaries))
long[1:nrow(salaries)] = 1.0

lat = c(nrow = nrow(salaries))
lat[1:nrow(salaries)] = 1.0



colleges <- add_column(colleges, Long = long, Lat = lat)


for (i in 1:nrow(colleges)) {
  
  addr = as.character(colleges[i, "Address"])
  

  if (!grepl( "NA", addr) ) {
    
    
    ge = geocode(addr, output = "latlona", source = "google")
   
    lat = ge$lat
    lon = ge$lon
      
    colleges[i, "Long"] <- lon
    colleges[i, "Lat"] <- lat
    
  }
  
  
}


select(colleges, `School Name`,Long, Lat, Address)


write_csv(colleges, "../data/college_data.csv")


```



